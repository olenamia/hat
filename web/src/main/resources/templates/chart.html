<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="ISO-8859-1">
<title>Google Charts Example - Spring Boot</title>
<script
    src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!--link rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"-->
<!--link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.min.js"></script-->
<!--link th:rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css} "/-->
<!--script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script-->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script th:src="@{/js/script.js}"></script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col d-flex align-items-center">
            <h5 class="text-secondary">Historical Data for [[${defaultState}]]</h5>
        </div>
        <div class="col">
            <ul id="chartTypes" style="float: right;">
                <li data-toggle="tab" href="#historical_values_pane" class="btn btn-outline-secondary active" style="width: 120px; margin-right: 5px;">Values</li>
                <li data-toggle="tab" href="#historical_yoy_pane" class="btn btn-outline-secondary" style="width: 140px; margin-right: 5px;">Year-over-Year</li>
                <li data-toggle="tab" href="#historical_table_pane" class="btn btn-outline-secondary" style="width: 120px;">Table</li>   
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div id="region" class="btn-group">
                <button id="regionDropDownA" type="button" th:text="${defaultState}" class="btn btn-secondary dropdown-toggle" style="width:225px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select Region
                </button>
                <div id="regionChoiceA" class="dropdown-menu dropdown-menu-right" aria-labelledby="regionDropDownA"  style="width:175px; text-align: left; max-height: 500px; overflow-y: scroll;" >
                    <div th:each="state : ${states}">
                    <a class="dropdown-item py-20"  href="#" data-method="updateRegion" th:attr="data-param1=${state.name}" data-param2="state" th:text="${state.name}"></a>
                    <div class="dropdown-divider"></div>
                    </div>
                </div>
                <div class="container">
                    <div id="regionTypes" class="btn-group" role="group" aria-label="Basic example">
                        <span class="text-secondary" style="margin-left:60px; margin-right:20px; display: flex; align-items: center;">Region type: </span>
                        <button type="button" class="btn btn-outline-secondary">US</button>
                        <button type="button" class="btn btn-outline-secondary active">State</button>
                        <button type="button" class="btn btn-outline-secondary">County</button>
                        <button type="button" class="btn btn-outline-secondary">Metro Area</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="tab-content" >
                <div class="tab-pane active" id="historical_values_pane">
                    <div id="historical_values_chart"></div>
                </div>
                <div class="tab-pane" id="historical_yoy_pane">
                    <div id="historical_yoy_chart"></div>
                </div>
                <div class="tab-pane" id="historical_table_pane">
                    <div id="historical_table_chart"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script th:inline="javascript">

    $(document).ready(function() {
        //$('[data-toggle=dropdown]').dropdown();
        // Add click event handler to the buttons
        $('#chartTypes li').click(function (e) {
            e.preventDefault();
            var href = $(this).attr('href');

            // Add active class to clicked button
            $('#chartTypes li').removeClass('active');
            $(this).addClass('active');

            // toggle the active class on the clicked tab and its associated pane
            //$(this).addClass('active').parent().siblings().find('a').removeClass('active');
            $(href).addClass('active').siblings().removeClass('active');
        });


        $('#regionChoiceA .dropdown-item').click(function(e) {
            e.preventDefault();
            var text = $(this).text(); // Get the text of the clicked dropdown item
            //$(this).closest('.btn-group').find('.btn').text(text); // Update the button's text
            $('#regionDropDownA').text(text); 
            
            // Get the method name and parameters from the data attributes
            var method = $(this).data('method');
            var param1 = $(this).data('param1');
            var param2 = $(this).data('param2');

            // Call the corresponding JavaScript method with the parameters
            window[method](param1, param2);

            //var originalDropdownHtml = $('#regionDropDownA').html();

// Reset the dropdown by replacing its HTML with the original HTML
//$('#regionDropDownA').html(originalDropdownHtml);

// Reinitialize the dropdown component
$('#regionDropDownA').dropdown();
        });
    });

        google.charts.load('current', {'packages':['table', 'line', 'bar', 'corechart']});

        google.charts.setOnLoadCallback(() => {
            var historicalData = /*[[${defaultStateHistoricalData}]]*/'{}';
            regionData = JSON.parse(historicalData);
            drawHomeValueChart(regionData, document.getElementById('historical_values_chart'));
            drawYoYChangeChart(regionData, document.getElementById('historical_yoy_chart'));
            drawTableChart(regionData, document.getElementById('historical_table_chart'));
            //drawColumnChart(regionData, document.getElementById('chart_div'));

            //drawChart('line_chart', /*[[${result}]]*/'{}');
            //drawChart2('line_yoy_chart', /*[[${otherResult}]]*/'{}');
        });





        /*function drawTable() {
          var data = new google.visualization.DataTable();
          data.addColumn('string', 'Date');
          data.addColumn('number', 'Home Value');
          data.addColumn('number', 'YoY change');

          real_data.forEach(function(key) {
                data.addRow([ key.date, {v: key.homeValue, f: "$"+key.homeValue}, key.yoyChange ]);
            });
  
          var table = new google.visualization.Table(document.getElementById('table_chart'));
  
          table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
        }*/
      </script>


</body>
</html>